<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hockey Pool Stat Estimator</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 10px; background: white; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #eee; }
  button { padding: 5px 10px; margin: 3px; }
  input[type="number"], input[type="text"] { width: 70px; }
  #controls { margin-bottom: 10px; }
  .small-input { width: 50px; }
</style>
</head>
<body>

<h1>Hockey Pool Stat Estimator</h1>

<div id="seasonInfo">
  <label>Games Played So Far: <input type="number" id="gamesPlayed" value="10" min="1" oninput="calculateAll()" class="small-input"></label>
  &nbsp;&nbsp;
  <label>Total Games in Season: <input type="number" id="totalGames" value="82" min="1" oninput="calculateAll()" class="small-input"></label>
</div>

<div id="controls">
  <button onclick="addCategory()">+ Add Category</button>
  <button onclick="addPlayer()">+ Add Player</button>
</div>

<table id="statsTable">
  <thead>
    <tr id="categoryRow">
      <th>Player</th>
    </tr>
    <tr id="pointsRow">
      <th>Points/Unit</th>
    </tr>
  </thead>
  <tbody id="playersBody">
  </tbody>
</table>

<h2>Results</h2>
<table id="resultsTable" style="width: 100%; background: white; border-collapse: collapse;">
  <thead>
    <tr>
      <th>Player</th>
      <th>Current Total Points</th>
      <th>Estimated Season Points</th>
    </tr>
  </thead>
  <tbody id="resultsBody"></tbody>
</table>

<script>
let categories = [];
let players = [];

function addCategory() {
  const catName = prompt("Enter category name:");
  if (!catName) return;
  categories.push(catName);

  // Add to stats table headers
  let headerRow = document.getElementById("categoryRow");
  let th = document.createElement("th");
  th.textContent = catName;
  headerRow.appendChild(th);

  // Points per unit inputs
  let pointsRow = document.getElementById("pointsRow");
  let td = document.createElement("td");
  let input = document.createElement("input");
  input.type = "number";
  input.step = "0.01";
  input.value = 1;
  input.oninput = calculateAll;
  td.appendChild(input);
  pointsRow.appendChild(td);

  // Add input cells for each player in existing rows
  document.querySelectorAll("#playersBody tr").forEach(row => {
    let td = document.createElement("td");
    let input = document.createElement("input");
    input.type = "number";
    input.step = "1";
    input.value = 0;
    input.oninput = calculateAll;
    input.min = "";
    input.max = "";
    td.appendChild(input);
    row.appendChild(td);
  });

  // Add total header if missing
  if (!document.getElementById("totalHeader")) {
    let totalTh = document.createElement("th");
    totalTh.textContent = "Current Total";
    totalTh.id = "totalHeader";
    headerRow.appendChild(totalTh);

    let blank = document.createElement("td");
    pointsRow.appendChild(blank);
  }
}

function addPlayer() {
  const playerName = prompt("Enter player name:");
  if (!playerName) return;
  players.push(playerName);

  let row = document.createElement("tr");
  let nameCell = document.createElement("td");
  nameCell.textContent = playerName;
  row.appendChild(nameCell);

  categories.forEach(() => {
    let td = document.createElement("td");
    let input = document.createElement("input");
    input.type = "number";
    input.step = "1";
    input.value = 0;
    input.oninput = calculateAll;
    input.min = "";
    input.max = "";
    td.appendChild(input);
    row.appendChild(td);
  });

  let totalCell = document.createElement("td");
  totalCell.textContent = "0";
  totalCell.className = "total";
  row.appendChild(totalCell);

  document.getElementById("playersBody").appendChild(row);
}

function calculateAll() {
  let gamesPlayed = Number(document.getElementById("gamesPlayed").value) || 1;
  let totalGames = Number(document.getElementById("totalGames").value) || gamesPlayed;

  let pointsPerCat = Array.from(document.querySelectorAll("#pointsRow td input")).map(inp => Number(inp.value) || 0);
  let tbody = document.getElementById("playersBody");
  let rows = Array.from(tbody.querySelectorAll("tr"));

  // Prepare results table body
  let resultsBody = document.getElementById("resultsBody");
  resultsBody.innerHTML = "";

  rows.forEach(row => {
    let inputs = Array.from(row.querySelectorAll("td input"));
    let currentTotal = 0;
    let projectedTotal = 0;

    // Calculate current total points
    inputs.forEach((inp, i) => {
      currentTotal += (Number(inp.value) || 0) * (pointsPerCat[i] || 0);
    });

    // Calculate projected points:
    // average stat per game * (total games) * points per unit
    inputs.forEach((inp, i) => {
      let avgPerGame = (Number(inp.value) || 0) / gamesPlayed;
      let projectedStat = avgPerGame * totalGames;
      projectedTotal += projectedStat * (pointsPerCat[i] || 0);
    });

    row.querySelector(".total").textContent = currentTotal.toFixed(2);
    row.dataset.total = projectedTotal;

    // Add to results table
    let resRow = document.createElement("tr");
    let playerName = row.children[0].textContent;

    let nameTd = document.createElement("td");
    nameTd.textContent = playerName;
    resRow.appendChild(nameTd);

    let currentTd = document.createElement("td");
    currentTd.textContent = currentTotal.toFixed(2);
    resRow.appendChild(currentTd);

    let projectedTd = document.createElement("td");
    projectedTd.textContent = projectedTotal.toFixed(2);
    resRow.appendChild(projectedTd);

    resultsBody.appendChild(resRow);
  });

  // Sort results descending by projected points
  let resRows = Array.from(resultsBody.querySelectorAll("tr"));
  resRows.sort((a, b) => parseFloat(b.children[2].textContent) - parseFloat(a.children[2].textContent));
  resRows.forEach(r => resultsBody.appendChild(r));
}

</script>

</body>
</html>